# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
%YAML 1.2
---
$id: "http://devicetree.org/schemas/misc/qcom,fastrpc.yaml#"
$schema: "http://devicetree.org/meta-schemas/core.yaml#"

title: Qualcomm FastRPC Driver

maintainers:
  - Srinivas Kandagatla <srinivas.kandagatla@linaro.org>

description: |
  The FastRPC implements an IPC (Inter-Processor Communication)
  mechanism that allows for clients to transparently make remote method
  invocations across DSP and APPS boundaries. This enables developers
  to offload tasks to the DSP and free up the application processor for
  other tasks.

properties:
  compatible:
    items:
      - const: qcom,fastrpc

  label:
    items:
      enum:
        - adsp
        - mdsp
        - sdsp
        - cdsp

  qcom,glink-channels: # HACK
    $ref: /schemas/types.yaml#/definitions/string
    description: |
      a list of channels tied to this function, used for matching
      the function to a set of virtual channels

  '#address-cells':
    const: 1

  '#size-cells':
    const: 0

patternProperties:
  "(compute-)?cb@[0-9]$":
    type: object

    description: >
      Each subnode of the Fastrpc represents compute context banks available on the dsp.

    properties:
      compatible:
        items:
          - const: qcom,fastrpc-compute-cb

      reg:
        maxItems: 1

      iommus: true # HACK?

      qcom,nsession:
        $ref: /schemas/types.yaml#/definitions/uint32
        default: 1
        description: >
          A value indicating how many sessions can share this context bank.

    required:
      - compatible
      - reg

    additionalProperties: false

required:
  - compatible
  - label
  - '#address-cells'
  - '#size-cells'

additionalProperties: false

examples:
  - |
    smd-edge {
        label = "lpass";
        fastrpc {
            compatible = "qcom,fastrpc";
            label = "adsp";
            qcom,smd-channels = "fastrpcsmd-apps-dsp";
            #address-cells = <1>;
            #size-cells = <0>;

            compute-cb@1 {
                compatible = "qcom,fastrpc-compute-cb";
                reg = <1>;
            };

            compute-cb@2 {
                compatible = "qcom,fastrpc-compute-cb";
                reg = <2>;
            };
        };
    };
