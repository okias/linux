# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/display/rockchip/rockchip,dw-mipi-dsi.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: Rockchip specific extensions to the Synopsys Designware MIPI DSI

maintainers:
  - opensource@rock-chips.com

allOf:
  - if:
      properties:
        compatible:
          contains:
            const: rockchip,px30-mipi-dsi
      then:
        properties:
          clocks:
            maxItems: 1
          clock-names:
            items:
              - const: pclk

  - if:
      properties:
        compatible:
          contains:
            const: rockchip,rk3288-mipi-dsi
      then:
        properties:
          clocks:
            maxItems: 2
          clock-names:
            items:
              - const: ref
              - const: pclk

  - if:
      properties:
        compatible:
          contains:
            const: rockchip,rk3399-mipi-dsi
      then:
        properties:
          clocks:
            minItems: 4
            maxItems: 4
          clock-names:
            items:
              - const: ref
              - const: pclk
              - const: phy_cfg
              - const: grf

properties:
  compatible:
    oneOf:
      - items:
          - enum:
              - rockchip,px30-mipi-dsi
              - rockchip,rk3288-mipi-dsi
              - rockchip,rk3399-mipi-dsi
          - const: snps,dw-mipi-dsi

  reg:
    maxItems: 1

  interrupts:
    maxItems: 1

  clocks: true

  clock-names: true

  phys:
    maxItems: 1
    description: Optional external PHY

  phy-names:
    const: dphy

  ports:
    $ref: /schemas/graph.yaml#/properties/ports

    properties:
      port@0:
        $ref: /schemas/graph.yaml#/$defs/port-base
        unevaluatedProperties: false
        description: >
          Video port for the VOP input.

        properties:
          endpoint@0:
            $ref: /schemas/graph.yaml#/properties/endpoint
            description: Connection to the VOPB

          endpoint@1:
            $ref: /schemas/graph.yaml#/properties/endpoint
            description: Connection to the VOPL

        required:
          - endpoint@0

      port@1:
        $ref: /schemas/graph.yaml#/properties/port
        description: >
          Video port for panel or subsequent encoder

    required:
      - port@0
      - port@1

  resets:
    maxItems: 1

  reset-names:
    items:
      - const: apb

  rockchip,grf:
    $ref: /schemas/types.yaml#/definitions/phandle
    description:
      phandle to the GRF to mux vopl/vopb

  power-domains: true

  '#address-cells':
    const: 1

  '#phy-cells':
    const: 0

  '#size-cells':
    const: 0

required:
  - compatible
  - reg
  - clocks
  - rockchip,grf
  - ports
  - '#address-cells'
  - '#size-cells'

additionalProperties: true

examples:
  - |
    #include <dt-bindings/clock/rk3288-cru.h>

    mipi_dsi: mipi@ff960000 {
        #address-cells = <1>;
        #size-cells = <0>;
        compatible = "rockchip,rk3288-mipi-dsi", "snps,dw-mipi-dsi";
        reg = <0xff960000 0x4000>;
        interrupts = <0 83 4>;
        clocks = <&cru 148>, <&cru PCLK_MIPI_DSI0>;
        clock-names = "ref", "pclk";
        resets = <&cru SRST_MIPIDSI0>;
        reset-names = "apb";
        rockchip,grf = <&grf>;

        ports {
            #address-cells = <1>;
            #size-cells = <0>;

            mipi_in: port@0 {
                reg = <0>;
                #address-cells = <1>;
                #size-cells = <0>;

                mipi_in_vopb: endpoint@0 {
                    reg = <0>;
                    remote-endpoint = <&vopb_out_mipi>;
                };
                mipi_in_vopl: endpoint@1 {
                    reg = <1>;
                    remote-endpoint = <&vopl_out_mipi>;
                };
            };

            mipi_out: port@1 {
                reg = <1>;
                #address-cells = <1>;
                #size-cells = <0>;

                mipi_out_panel: endpoint {
                    remote-endpoint = <&panel_in_mipi>;
                };
            };
        };
    };
