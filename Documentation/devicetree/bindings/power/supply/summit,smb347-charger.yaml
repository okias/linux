# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
%YAML 1.2
---
$id: "http://devicetree.org/schemas/power/supply/summit,smb347-charger.yaml#"
$schema: "http://devicetree.org/meta-schemas/core.yaml#"

title: Battery charger driver for SMB345, SMB347 and SMB358

maintainers:
  - David Heidelberg <david@ixit.cz>

properties:
  compatible:
    enum:
      - summit,smb345
      - summit,smb347
      - summit,smb358

  reg:
    maxItems: 1

  interrupts:
    maxItems: 1

  summit,enable-usb-charging:
    type: boolean
    description: Enable charging trough USB.

  summit,enable-otg-charging:
    type: boolean
    description: Provide power for USB OTG

  summit,enable-mains-charging:
    type: boolean
    description: Enable charging trough mains

  summit,enable-chg-ctrl:
    allOf:
      - $ref: /schemas/types.yaml#/definitions/uint8
      - enum: [0, 1, 2]
    description: Enable charging control
    items:
      - description: <0> - SW (i2c interface)
      - description: <1> - Pin control (Active Low)
      - description: <2> - Pin control (Active High)

  summit,max-chg-curr:
    allOf:
      - $ref: /schemas/types.yaml#/definitions/uint8
    description: Maximum current for charging (in uA)
    minimum: 700000
    maximum: 2500000

  summit,max-chg-volt:
    allOf:
      - $ref: /schemas/types.yaml#/definitions/uint8
    description: Maximum voltage for charging (in uV)
    minimum: 3500000
    maximum: 4500000

  summit,pre-chg-curr:
    allOf:
      - $ref: /schemas/types.yaml#/definitions/uint8
    description: Pre-charging current for charging (in uA)
    minimum: 100000
    maximum: 250000

  summit,term-curr:
    allOf:
      - $ref: /schemas/types.yaml#/definitions/uint8
      - minimum: 37500
      - maximum: 600000
    description: Charging cycle termination current (in uA)

  summit,fast-volt-thershold:
    allOf:
      - $ref: /schemas/types.yaml#/definitions/uint8
    description: Voltage threshold to transit to fast charge mode (in uV)
    minimum: 2400000
    maximum: 3000000

  summit,mains-curr-limit:
    allOf:
      - $ref: /schemas/types.yaml#/definitions/uint8
    description: Maximum input current from AC/DC input (in uA)
    minimum: 300000
    maximum: 2500000

  summit,usb-curr-limit:
    allOf:
      - $ref: /schemas/types.yaml#/definitions/uint8
    description: Maximum input current from USB input (in uA)
    minimum: 300000
    maximum: 2500000

  summit,chip-temp-threshold:
    allOf:
      - $ref: /schemas/types.yaml#/definitions/uint8
    description: Chip temperature for thermal regulation in °C.
    enum: [100, 110, 120, 130]

  summit,soft-cold-temp-limit:
    allOf:
      - $ref: /schemas/types.yaml#/definitions/uint8
    description: Cold battery temperature in °C for soft alarm.
    enum: [0, 5, 10, 15]

  summit,soft-hot-temp-limit:
    allOf:
      - $ref: /schemas/types.yaml#/definitions/uint8
    description: Hot battery temperature in °C for soft alarm.
    enum: [40, 45, 50, 55]

  summit,hard-cold-temp-limit:
    allOf:
      - $ref: /schemas/types.yaml#/definitions/uint8
    description: Cold battery temperature in °C for hard alarm.
    enum: [-5, 0, 5, 10]

  summit,hard-hot-temp-limit:
    allOf:
      - $ref: /schemas/types.yaml#/definitions/uint8
    description: Hot battery temperature in °C for hard alarm.
    enum: [50, 55, 60, 65]

  summit,soft-comp-method:
    allOf:
      - $ref: /schemas/types.yaml#/definitions/uint8
    description: |
      Soft temperature limit compensation method
      (Not defined) - Use default setting
    items:
      - description: <0> - Compensation none
      - description: <1> - Charge current compensation
      - description: <2> - Voltage compensation


required:
  - compatible
  - reg

anyOf:
  - required:
      - summit,enable-usb-charging
  - required:
      - summit,enable-otg-charging
  - required:
      - summit,enable-mains-charging

examples:
  - |
    i2c {
        #address-cells = <1>;
        #size-cells = <0>;

        power_supply: charger@7f {
            compatible = "summit,smb347";
            reg = <0x7f>;
            status = "okay";

            summit,max-chg-curr = <1800000>;
            summit,mains-curr-limit = <2000000>;
            summit,usb-curr-limit = <450000>;

            summit,chip-temp-thershold = <110>;
            summit,soft-cold-temp-limit = <(-5)>;

            summit,enable-usb-charging;
            summit,enable-mains-charging;

            summit,enable-chg-ctrl = <2>;  /* Pin control (Active High) */
        };
    };
