# SPDX-License-Identifier: GPL-2.0-only
%YAML 1.2
---
$id: http://devicetree.org/schemas/arm/coresight-etm.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: ARM Coresight Embedded Trace Macrocell device

description: FIXME TODO

maintainers:
  - Mike Leach <mike.leach@linaro.org>

allOf:
  - $ref: "coresight.yaml"

# Need a custom select here or 'arm,primecell' will match on lots of nodes
select:
  properties:
    compatible:
      contains:
        enum:
          - arm,coresight-etm
  required:
    - compatible

properties:
  $nodename:
    pattern: "^(e|p)tm(@[0-9a-f]+)$"

  compatible:
    oneOf:
      - items:  # Version 3.x;  Program Flow Trace Macrocell
          - const: arm,coresight-etm3x
          - const: arm,primecell
      - items:  # Version 4.x; with memory mapped access
          - const: arm,coresight-etm4x
          - const: arm,primecell
      - items:  # Version 4.x; with system register access only
          - const: arm,coresight-etm4x-reg
          - const: arm,primecell

  reg:
    maxItems: 1

  cpu:
    $ref: /schemas/types.yaml#/definitions/phandle

  arm,cp14:
    type: boolean
    description: >
      must be present if the system accesses ETM/PTM management
      registers via co-processor 14

  qcom,skip-power-up:
    type: boolean
    description: >
      Indicates that an implementation can
      skip powering up the trace unit. TRCPDCR.PU does not have to be set
      on Qualcomm Technologies Inc. systems since ETMs are in the same power
      domain as their CPU cores. This property is required to identify such
      systems with hardware errata where the CPU watchdog counter is stopped
      when TRCPDCR.PU is set.

patternProperties:
  '(in|out)-ports':
    $ref: /schemas/graph.yaml#/properties/ports

required:
  - compatible
  - reg
  - clocks
  - clock-names

unevaluatedProperties: false
